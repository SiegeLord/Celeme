<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>celeme.config</title>
  <link href="css/style.css" rel="stylesheet" type="text/css"/>
  <!-- no favicon -->
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/utilities.js"></script>
  <script type="text/javascript" src="js/symbols.js"></script>
  <script type="text/javascript" src="js/modules.js"></script>
  <script type="text/javascript" src="js/quicksearch.js"></script>
  <script type="text/javascript" src="js/treeview.js"></script>
  <script type="text/javascript" src="js/navigation.js"></script>
</head>
<body id="celeme.config">
<div id="kandil-content">
<div class="module">
  <h1 class="module" id="m-celeme.config"><a href="htmlsrc/celeme.config.html" class="symbol">celeme.config</a></h1>

<div class="summary"><div class="cmnt">This module provides support for a simple configuration file format
 with D-like syntax. Both C++ and C comments are supported with
 the added enhancement that C comments are now nesting. The configuration file
 is composed of entries. Each entry has a name. The names need not be unique,
 and it is up to the application what to do with multiple entries (it could even
 dissallow them if need be). There are two types of entries, single value entries 
 and aggregate entries. Single value entries can either be empty or hold one value:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex1" name="L1_ex1">1</a>
<a href="#L2_ex1" name="L2_ex1">2</a>
<a href="#L3_ex1" name="L3_ex1">3</a>
<a href="#L4_ex1" name="L4_ex1">4</a>
<a href="#L5_ex1" name="L5_ex1">5</a>
<a href="#L6_ex1" name="L6_ex1">6</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">sentinel</span>; <span class="lc">// This one does not hold any value</span>
<span class="i">size</span> <span class="n">5</span>;
<span class="i">mass</span> <span class="n">1.2</span>;
<span class="i">length</span> <span class="n">1.3e-5</span>;
<span class="i">name</span> <span class="sl">"Test"</span>;
<span class="i">some_code</span> <span class="sl">`printf("%d")`</span>;</pre>
</td></tr>
</table>
 
 Values can be integers, floating point literals and strings.
 Strings can either be delimeted by the " character, or the ` character.
 The former support standard escape characters, while the latter have only a single escape character: \` which
 transforms to `.
 
 Aggregate entries contain children entries:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex2" name="L1_ex2">1</a>
<a href="#L2_ex2" name="L2_ex2">2</a>
<a href="#L3_ex2" name="L3_ex2">3</a>
<a href="#L4_ex2" name="L4_ex2">4</a>
<a href="#L5_ex2" name="L5_ex2">5</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">address</span>
{
   <span class="i">street</span> <span class="sl">"Quiet St."</span>;
   <span class="i">number</span> <span class="n">125</span>;
}</pre>
</td></tr>
</table>
 
 An alternate syntax can be used if the aggregate only has a single entry:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex3" name="L1_ex3">1</a>
<a href="#L2_ex3" name="L2_ex3">2</a>
<a href="#L3_ex3" name="L3_ex3">3</a>
<a href="#L4_ex3" name="L4_ex3">4</a>
<a href="#L5_ex3" name="L5_ex3">5</a>
<a href="#L6_ex3" name="L6_ex3">6</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">animal</span> <span class="i">dog</span>;

<span class="i">animal</span>
{
   <span class="i">dog</span>;
}</pre>
</td></tr>
</table>
 
 The above two animal entries are identical. Naturally, aggregate entries can
 be nested:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex4" name="L1_ex4">1</a>
<a href="#L2_ex4" name="L2_ex4">2</a>
<a href="#L3_ex4" name="L3_ex4">3</a>
<a href="#L4_ex4" name="L4_ex4">4</a>
<a href="#L5_ex4" name="L5_ex4">5</a>
<a href="#L6_ex4" name="L6_ex4">6</a>
<a href="#L7_ex4" name="L7_ex4">7</a>
<a href="#L8_ex4" name="L8_ex4">8</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">animal</span> <span class="i">dog</span> <span class="i">Spotty</span>;
<span class="i">object</span>
{
   <span class="i">children</span>
   {
       <span class="i">Amy</span>;
   }
}</pre>
</td></tr>
</table>
 
 Lastly, this file format supports includes:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex5" name="L1_ex5">1</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">include</span> <span class="sl">"some_other_file"</span>;</pre>
</td></tr>
</table>
 
 This will effectively paste the contents of the other file inside this file.
 Circular includes are forbidden. You can additional specify specific entries 
 include (or exclude). For example:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex6" name="L1_ex6">1</a>
<a href="#L2_ex6" name="L2_ex6">2</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">include</span> <span class="sl">"some_other_file"</span>+<span class="i">A</span>,<span class="i">B</span>; <span class="lc">// Only A and B will be included</span>
<span class="i">include</span> <span class="sl">"some_other_file"</span>-<span class="i">A</span>,<span class="i">B</span>; <span class="lc">// All entries except A and B will be included</span></pre>
</td></tr>
</table>
 
 It is also possible to include the contents of aggregate entries in other
 aggregate entries using the include statement.
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex7" name="L1_ex7">1</a>
<a href="#L2_ex7" name="L2_ex7">2</a>
<a href="#L3_ex7" name="L3_ex7">3</a>
<a href="#L4_ex7" name="L4_ex7">4</a>
<a href="#L5_ex7" name="L5_ex7">5</a>
<a href="#L6_ex7" name="L6_ex7">6</a>
<a href="#L7_ex7" name="L7_ex7">7</a>
<a href="#L8_ex7" name="L8_ex7">8</a>
<a href="#L9_ex7" name="L9_ex7">9</a>
<a href="#L10_ex7" name="L10_ex7">10</a>
<a href="#L11_ex7" name="L11_ex7">11</a>
<a href="#L12_ex7" name="L12_ex7">12</a>
<a href="#L13_ex7" name="L13_ex7">13</a>
<a href="#L14_ex7" name="L14_ex7">14</a>
<a href="#L15_ex7" name="L15_ex7">15</a>
<a href="#L16_ex7" name="L16_ex7">16</a>
<a href="#L17_ex7" name="L17_ex7">17</a>
<a href="#L18_ex7" name="L18_ex7">18</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">A</span>
{
    <span class="i">a</span>;
    <span class="i">b</span>;
    <span class="i">C</span>
    {
        <span class="i">c</span>;
        <span class="i">d</span>;
    }
}

<span class="i">B</span>
{
   <span class="i">include</span> <span class="i">A</span>+<span class="i">a</span>,<span class="i">b</span>;
   <span class="i">include</span> <span class="i">A</span>.<span class="i">C</span>-<span class="i">d</span>;
}

<span class="lc">// B now contains entries a, b and c</span></pre>
</td></tr>
</table>
 
 When used like that, only the last match to the specifier is used:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex8" name="L1_ex8">1</a>
<a href="#L2_ex8" name="L2_ex8">2</a>
<a href="#L3_ex8" name="L3_ex8">3</a>
<a href="#L4_ex8" name="L4_ex8">4</a>
<a href="#L5_ex8" name="L5_ex8">5</a>
<a href="#L6_ex8" name="L6_ex8">6</a>
<a href="#L7_ex8" name="L7_ex8">7</a>
<a href="#L8_ex8" name="L8_ex8">8</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">A</span> <span class="i">a</span> <span class="n">1</span>;
<span class="i">A</span> <span class="i">a</span> <span class="n">6</span>;
<span class="i">B</span>
{
    <span class="i">include</span> <span class="i">A</span>;
}

<span class="lc">// B now contains the a with a default value of 6</span></pre>
</td></tr>
</table>
 
 Some example usage:
 
 <table class="d_code">
  <tr><td class="d_codelines">
<pre><a href="#L1_ex9" name="L1_ex9">1</a>
<a href="#L2_ex9" name="L2_ex9">2</a>
<a href="#L3_ex9" name="L3_ex9">3</a>
<a href="#L4_ex9" name="L4_ex9">4</a>
<a href="#L5_ex9" name="L5_ex9">5</a>
<a href="#L6_ex9" name="L6_ex9">6</a>
<a href="#L7_ex9" name="L7_ex9">7</a>
<a href="#L8_ex9" name="L8_ex9">8</a>
<a href="#L9_ex9" name="L9_ex9">9</a>
<a href="#L10_ex9" name="L10_ex9">10</a>
<a href="#L11_ex9" name="L11_ex9">11</a>
<a href="#L12_ex9" name="L12_ex9">12</a>
<a href="#L13_ex9" name="L13_ex9">13</a>
<a href="#L14_ex9" name="L14_ex9">14</a>
<a href="#L15_ex9" name="L15_ex9">15</a>
<a href="#L16_ex9" name="L16_ex9">16</a>
<a href="#L17_ex9" name="L17_ex9">17</a>
<a href="#L18_ex9" name="L18_ex9">18</a>
<a href="#L19_ex9" name="L19_ex9">19</a>
<a href="#L20_ex9" name="L20_ex9">20</a>
<a href="#L21_ex9" name="L21_ex9">21</a>
<a href="#L22_ex9" name="L22_ex9">22</a>
<a href="#L23_ex9" name="L23_ex9">23</a>
<a href="#L24_ex9" name="L24_ex9">24</a>
<a href="#L25_ex9" name="L25_ex9">25</a>
<a href="#L26_ex9" name="L26_ex9">26</a>
<a href="#L27_ex9" name="L27_ex9">27</a>
<a href="#L28_ex9" name="L28_ex9">28</a>
<a href="#L29_ex9" name="L29_ex9">29</a>
<a href="#L30_ex9" name="L30_ex9">30</a>
<a href="#L31_ex9" name="L31_ex9">31</a>
<a href="#L32_ex9" name="L32_ex9">32</a>
<a href="#L33_ex9" name="L33_ex9">33</a>
</pre></td><td class="d_codetext"><pre>
<span class="i">cstring</span> <span class="i">file</span> = 
<span class="sl">`
value 5;
value 7;
container
{
    contents "Hello";
}
`</span>;

<span class="k">auto</span> <span class="i">root</span> = <span class="i">LoadConfig</span>(<span class="sl">""</span>, <span class="i">file</span>);

<span class="lc">// Get all entries named "value"</span>
<span class="k">foreach</span>(<span class="i">entry</span>; <span class="i">root</span>[<span class="sl">"value"</span>])
   <span class="i">Stdout</span>(<span class="i">entry</span>.<span class="i">Value</span>!(<span class="k">int</span>)).<span class="i">nl</span>; <span class="lc">// Will print 5 and then 7</span>

<span class="lc">// Get only the last value</span>
<span class="k">auto</span> <span class="i">last_value</span> = <span class="i">root</span>[<span class="sl">"value"</span>, <span class="k">true</span>];
<span class="i">Stdout</span>(<span class="i">last_value</span>.<span class="i">Value</span>!(<span class="k">int</span>)).<span class="i">nl</span>; <span class="lc">// Will print 7</span>

<span class="lc">// A shortcut for the above</span>
<span class="i">Stdout</span>(<span class="i">root</span>.<span class="i">ValueOf</span>!(<span class="k">int</span>)(<span class="sl">"value"</span>)).<span class="i">nl</span>; <span class="lc">// Will print 7</span>

<span class="lc">// Providing a default value</span>
<span class="i">Stdout</span>(<span class="i">root</span>.<span class="i">ValueOf</span>!(<span class="k">int</span>)(<span class="sl">"not_there"</span>, -<span class="n">1</span>)).<span class="i">nl</span>; <span class="lc">// Will print -1</span>

<span class="k">auto</span> <span class="i">container</span> = <span class="i">root</span>[<span class="sl">"container"</span>, <span class="k">true</span>];
<span class="k">if</span>(<span class="i">container</span>.<span class="i">IsAggregateEntry</span>)
{
   <span class="lc">//Loop through all the contents of the container</span>
   <span class="k">foreach</span>(<span class="i">entry</span>; <span class="i">container</span>)
       <span class="i">Stdout</span>(<span class="i">entry</span>.<span class="i">Name</span>, <span class="i">entry</span>.<span class="i">Value</span>!(<span class="i">cstring</span>)).<span class="i">nl</span>; <span class="lc">// Will print contents, Hello</span>
}</pre>
</td></tr>
</table></div></div>
<dl>
<dt class="decl"><span class="rettyp">CAggregate</span> <a class="symbol _function" name="LoadConfig" href="htmlsrc/celeme.config.html#L196">LoadConfig</a><span class="params">(cstring <em>filename</em>, cstring[] <em>include_dirs</em> = <span class="defval"><span class="k">null</span></span>, cstring <em>src</em> = <span class="defval"><span class="k">null</span></span>)</span> <a href="celeme.config.html#LoadConfig" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Create a configuration entry from a file or a string.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>filename</em></td><td>Name of the file to load if no source is provided.</td></tr>
<tr><td><em>include_dirs</em></td><td>Array of directories to look at when resolving includes (including this call). Current directory is always searched first.</td></tr>
<tr><td><em>src</em></td><td>If set, must contain the source to load from.</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">An entry representing the top-level entry of the configuration file.</div></dd>
<dt class="decl"><span class="kw">class</span> <a class="symbol _class" name="CConfigEntry" href="htmlsrc/celeme.config.html#L207">CConfigEntry</a> <a href="celeme.config.html#CConfigEntry" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">A configuration entry, which represents a single node in the configuration file.
 
 An entry can both be a single entry (e.g. "entry = data;" or "entry;") or an aggregate
 (e.g. "entry { data; }" or "entry data;").</div></div>
<dl>
<dt class="decl"><span class="rettyp">CConfigEntry</span> <a class="symbol _function" name="CConfigEntry.dup" href="htmlsrc/celeme.config.html#L218">dup</a><span class="params">()</span> <span class="attrs">[<span class="stc">@property</span>]</span> <a href="celeme.config.html#CConfigEntry.dup" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Duplicate this entry</div></div></dd>
<dt class="decl"><span class="rettyp">CConfigEntry</span> <a class="symbol _function" name="CConfigEntry.copy" href="htmlsrc/celeme.config.html#L227">copy</a><span class="params">(CConfigEntry <em>ret</em>)</span> <a href="celeme.config.html#CConfigEntry.copy" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Copy this entry</div></div></dd>
<dt class="decl"><span class="rettyp">T</span> <a class="symbol _function" name="CConfigEntry.Value" href="htmlsrc/celeme.config.html#L244">Value</a><span class="tparams">(<em>T</em>)</span><span class="params">(T <em>def</em> = <span class="defval"><span class="i">init</span></span>, bool* <em>is_def</em> = <span class="defval"><span class="k">null</span></span>)</span> <a href="celeme.config.html#CConfigEntry.Value" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Get the value of this entry</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>def</em></td><td>Default value returned if some error occured.</td></tr>
<tr><td><em>is_def</em></td><td>Pointer to a bool that is set to true if the default value is returned.
              Set to false otherwise.</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">The value of this entry. If the value is not set, or the
 entry is an aggregate, then the default value is returned, and the
 is_def argument is set to true (if it is not null).</div></dd>
<dt class="decl"><span class="rettyp">T</span> <a class="symbol _function" name="CConfigEntry.ValueOf" href="htmlsrc/celeme.config.html#L279">ValueOf</a><span class="tparams">(<em>T</em>)</span><span class="params">(cstring <em>name</em>, T <em>def</em> = <span class="defval"><span class="i">init</span></span>, bool* <em>is_def</em> = <span class="defval"><span class="k">null</span></span>)</span> <a href="celeme.config.html#CConfigEntry.ValueOf" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Shortcut for accessing a single child entry of this aggregate and returning its value.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>name</em></td><td>Name of the child entry.</td></tr>
<tr><td><em>def</em></td><td>Default value returned if some error occured.</td></tr>
<tr><td><em>is_def</em></td><td>Pointer to a bool that is set to true if the default value is returned.
              Set to false otherwise.</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">The value of this entry. If the value is not set, or the
 entry is an aggregate, then the default value is returned, and the
 is_def argument is set to true (if it is not null).</div>
<p class="sec_header">See Also:</p><div class="cmnt"><a href="#CConfigEntry.Value">Value</a></div></dd>
<dt class="decl"><span class="rettyp">SEntryFruct</span> <a class="symbol _function" name="CConfigEntry.opIndex" href="htmlsrc/celeme.config.html#L303">opIndex</a><span class="params">(cstring <em>name</em>)</span> <a href="celeme.config.html#CConfigEntry.opIndex" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Get an array of entries that match the provided name.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>name</em></td><td>Name to match.</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">Returns an iterable fruct of all the entries that match this name.</div></dd>
<dt class="decl"><span class="rettyp">CConfigEntry</span> <a class="symbol _function" name="CConfigEntry.opIndex:2" href="htmlsrc/celeme.config.html#L316">opIndex</a><span class="params">(cstring <em>name</em>, bool <em>last</em>)</span> <a href="celeme.config.html#CConfigEntry.opIndex:2" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Get the last entries that matches the provided name.</div></div>
<p class="sec_header">Parameters:</p>
<table class="params">
<tr><td><em>name</em></td><td>Name to match.</td></tr></table>
<p class="sec_header">Returns:</p><div class="cmnt">The found entry. null otherwise.</div></dd>
<dt class="decl"><span class="rettyp">SEntryFruct</span> <a class="symbol _function" name="CConfigEntry.opSlice" href="htmlsrc/celeme.config.html#L365">opSlice</a><span class="params">()</span> <a href="celeme.config.html#CConfigEntry.opSlice" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Returns an iterable fruct that goes over all children of this node.</div></div></dd>
<dt class="decl"><span class="rettyp">bool</span> <a class="symbol _function" name="CConfigEntry.IsAggregate" href="htmlsrc/celeme.config.html#L374">IsAggregate</a><span class="params">()</span> <span class="attrs">[<span class="stc">@property</span>]</span> <a href="celeme.config.html#CConfigEntry.IsAggregate" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Returns true if this entry is an aggregate.</div></div></dd>
<dt class="decl"><span class="rettyp">bool</span> <a class="symbol _function" name="CConfigEntry.IsSingleValue" href="htmlsrc/celeme.config.html#L383">IsSingleValue</a><span class="params">()</span> <span class="attrs">[<span class="stc">@property</span>]</span> <a href="celeme.config.html#CConfigEntry.IsSingleValue" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Returns true if this entry is a single value.</div></div></dd>
<dt class="decl">cstring <a class="symbol _variable" name="CConfigEntry.Name" href="htmlsrc/celeme.config.html#L391">Name</a> <a href="celeme.config.html#CConfigEntry.Name" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Name of this entry.</div></div></dd>
<dt class="decl">CConfigEntry <a class="symbol _variable" name="CConfigEntry.Next" href="htmlsrc/celeme.config.html#L396">Next</a> <a href="celeme.config.html#CConfigEntry.Next" class="plink">¶</a></dt>
<dd class="ddef">
<div class="summary"><div class="cmnt">Next entry in the single linked list of entries.</div></div></dd></dl></dd></dl>
</div>
<div id="kandil-footer">
  <p></p>
  <p>Page generated by <a href="http://code.google.com/p/dil">dil</a> on Sun Mar 11 23:25:11 2012. Rendered by <a href="http://code.google.com/p/dil/wiki/Kandil">kandil</a>.</p>
</div>
</div>
</body>
</html>